<div style="min-height: 100vh; display: flex; flex-direction: column;">
  <div class="container mt-4">
    <section class="mb-4 text-center heading-section">
      <h3><br>Leave Balance Management</h3>
      <p class="text-muted">Manage employee leave balances efficiently. Add, view, update, and search leave balances.</p>
    </section>

    <div *ngIf="error && myLeaveBalances.length !== 0" class="alert alert-danger">{{ error }}</div>
    <div *ngIf="success" class="alert alert-success">{{ success }}</div>
    <div *ngIf="!canGetMy()" class="alert alert-warning">
      You do not have permission to view leave balances.
    </div>

    <!-- Add Leave Balance Section -->
    <div *ngIf="canAdd()" class="card p-4 mb-4">
      <h5 class="mb-3">Add Leave Balance</h5>
      <form (ngSubmit)="addLeaveBalance()" #addForm="ngForm" class="form-grid">
        <div class="form-group">
          <input type="number" [(ngModel)]="newLeaveBalance.employeeID" name="employeeID" required min="1" class="form-control" />
          <label>Employee ID</label>
        </div>
        <div class="form-group">
          <select [(ngModel)]="newLeaveBalance.leaveType" name="leaveType" required class="form-control">
            <option value="" disabled selected>Select Leave Type</option>
            <option *ngFor="let leaveType of leaveTypeOptions" [value]="leaveType">{{leaveType}}</option>
          </select>
          <label>Leave Type</label>
        </div>
        <div class="form-group">
          <input type="number" [(ngModel)]="newLeaveBalance.balance" name="balance" required min="0" class="form-control" />
          <label>Balance</label>
        </div>
        <button type="submit" class="btn btn-primary" [disabled]="addForm.invalid">Add</button>
      </form>
    </div>

    <!-- Fetch Leave Balance By ID Section -->
    <div *ngIf="canViewById()" class="card p-4 mb-4">
      <h5 class="mb-3">Fetch Leave Balance By ID</h5>
      <form (ngSubmit)="getLeaveBalanceById()" #fetchForm="ngForm" class="form-grid">
        <div class="form-group">
          <input type="number" [(ngModel)]="searchLeaveBalanceId" name="searchLeaveBalanceId" required min="1" class="form-control" />
          <label>Leave Balance ID</label>
        </div>
        <button type="submit" class="btn btn-info" [disabled]="fetchForm.invalid">Fetch</button>
      </form>
      <div *ngIf="selectedLeaveBalance" class="alert alert-success mt-3">
        <h6>Leave Balance Details</h6>
        <ul class="mb-0">
          <li><strong>ID:</strong> {{ selectedLeaveBalance.leaveBalanceID }}</li>
          <li><strong>Employee ID:</strong> {{ selectedLeaveBalance.employeeID }}</li>
          <li><strong>Leave Type:</strong> {{ selectedLeaveBalance.leaveType }}</li>
          <li><strong>Balance:</strong> {{ selectedLeaveBalance.balance }}</li>
        </ul>
      </div>
    </div>

    <!-- All Leave Balances Section -->
    <div *ngIf="canViewAll()" class="card p-4 mb-4">
      <h5 class="mb-3">All Leave Balances</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered">
          <thead class="thead-dark">
            <tr>
              <th>Leave Balance ID</th>
              <th>Employee ID</th>
              <th>Leave Type</th>
              <th>Balance</th>
              <th *ngIf="roles.includes('Admin')">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lb of leaveBalances">
              <td>{{lb.leaveBalanceID}}</td>
              <td>{{lb.employeeID}}</td>
              <td>{{lb.leaveType}}</td>
              <td>{{lb.balance}}</td>
              <td *ngIf="roles.includes('Admin')">
                <button class="btn btn-sm btn-info button-spacing" (click)="prepareUpdate(lb)">Edit</button>
                <button class="btn btn-sm btn-danger" (click)="deleteLeaveBalance(lb.leaveBalanceID)">Delete</button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Update Leave Balance Section -->
    <div *ngIf="canUpdate() && updateId!==null" class="card p-4 mb-4">
      <h5 class="mb-3">Update Leave Balance</h5>
      <form (ngSubmit)="updateLeaveBalance()" #updateForm="ngForm" class="form-grid">
        <div class="form-group">
          <select [(ngModel)]="updateLeaveBalanceDto.leaveType" name="updateLeaveType" required class="form-control">
            <option value="" disabled>Select Leave Type</option>
            <option *ngFor="let leaveType of leaveTypeOptions" [value]="leaveType">{{leaveType}}</option>
          </select>
          <label>Leave Type</label>
        </div>
        <div class="form-group">
          <input type="number" [(ngModel)]="updateLeaveBalanceDto.balance" name="updateBalance" required min="0" class="form-control" />
          <label>Balance</label>
        </div>
        <div class="form-actions">
          <button type="submit" class="btn btn-success" [disabled]="updateForm.invalid">Update</button>
          <button type="button" class="btn btn-secondary" (click)="updateId=null">Cancel</button>
        </div>
      </form>
    </div>

    <!-- My Leave Balances Section -->
    <div *ngIf="canGetMy()" class="card p-4 mb-4">
      <h5 class="mb-3">My Leave Balances</h5>
      <div class="table-responsive">
        <table class="table table-striped table-bordered" *ngIf="myLeaveBalances.length > 0">
          <thead class="thead-dark">
            <tr>
              <th>Leave Type</th>
              <th>Balance</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lb of myLeaveBalances">
              <td>{{lb.leaveType}}</td>
              <td>{{lb.balance}}</td>
            </tr>
          </tbody>
        </table>
        <div *ngIf="myLeaveBalances.length === 0" class="alert alert-warning mt-3">
          No leave balances found.
        </div>
      </div>
    </div>

    <!-- Success Modal -->
    <div *ngIf="showSuccessModal" class="modal-overlay">
      <div class="modal-content">
        <h5 class="mb-3">{{ successMessage }}</h5>
        <button class="btn btn-success" (click)="closeSuccessModal()">OK</button>
      </div>
    </div>
  </div>
</div>